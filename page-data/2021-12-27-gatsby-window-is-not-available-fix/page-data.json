{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/2021-12-27-gatsby-window-is-not-available-fix/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p>이 포스트는 gatsby의 특징과 사용자들이 자주 접할 수 밖에 없는 오류를 다룬다.</p>\n<h2>😨”window is not available”</h2>\n<p>열심히 코드짜고 글 올린 다음에</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> build</code></pre></div>\n<p>했더니 window is not available…</p>\n<p>잘 생각해야한다. window 객체는 어디있는가?</p>\n<p>node.js 환경은 window 객체를 가지고 있지 않다.</p>\n<p>우리가 window객체를 사용할 때는 브라우저 위가 아니었는가?</p>\n<p>이를 해결하기 위해 우리는 두 방법 정도가 있을 것이다.</p>\n<p>“조건문에 감싸서 window가 없는 환경에서도 에러가 안나게 만든다.”</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> window<span class=\"token operator\">===</span><span class=\"token keyword\">undefined</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span></code></pre></div>\n<p>“useEffect를 사용하여 서버사이드에서는 문제가 안 생기게 만든다.”</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGoBack</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> navRef <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">goBackPage</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> window<span class=\"token punctuation\">.</span>history<span class=\"token punctuation\">.</span><span class=\"token function\">back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">/* ... */</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>useEffect는 클라이언트 사이드 렌더링 시에 실행되므로 빌드 시에는 실행되지 않아 에러가 생기지 않는다.</p>\n<h2>😨”IntersectionObserver is not available”</h2>\n<p>이 블로그 같은 경우에는 IntersectionObserver를 사용해서 인피니트 스크롤을 구현했는데</p>\n<p>이도 window객체를 사용하는 라이브러리이기에 같은 에러가 발생했다.</p>\n<p>따라서 useEffect를 사용하여 문제를 해결했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    observer<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IntersectionObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">entries<span class=\"token punctuation\">,</span> observer</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>entries<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>isIntersecting<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n\n      <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">value</span> <span class=\"token operator\">=></span> value <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n      observer<span class=\"token punctuation\">.</span><span class=\"token function\">unobserve</span><span class=\"token punctuation\">(</span>entries<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>코드를 설명하자면</p>\n<p>포스트 리스트에 연결된 요소들을 entries 인자에서 하나만 바라본다.</p>\n<p>이제 포스트 하나씩 더 볼때마다 setCount에서 1이 올라가서 몇개의 포스트를 확인했는 지 확인할 수 있는 구조이다.</p>\n<h2>마무리</h2>\n<p>빌드환경과 배포된 환경이 다름을 통해 생기는 문제를 if문과 useEffect를 이용하여 해결하여 보았다.</p>\n<p>예상치 못한 오류가 발생했을 때 코드의 문제만 생각하는 게 아니라 환경도 생각해야함을 인지 할 수 있는 예시여서 블로그에도 꼭 소개하고 싶었다.</p>\n<p>다음은 검색 엔진 최적화나 웹 접근성을 높인 방법에 대해서 소개하고 싶다.</p>","frontmatter":{"title":"gatsbyjs 버그 잡기(not available)","summary":"window is not available, IntersectionObserver is not available 해결","date":"2021.12.27.","categories":["Blog"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkklEQVQoz2MI0WklGzFAqFDd1lDdtmDtllC9NhI167YGabUEqDeF67cHqDcFa0ONA5mlCze6NUQbjFA0g3Q2Rxl3Tq3ZvGLKwa68NcHaLcHaLYEazZFGHSCGZrO/apO/WlOoLshRgZrNITogc0GaQ/Xa/FQbp9ZuuXvl2Ye3X14//zipYqOnXG1P4dpZzdtjzXvCDdpzvaanOU3KcJ3cU7g2WKslSLMl3KAjWBvs7GDt1rUzj+xace7j26/Xzj6a37kr0rBjxZSDbVkrd608t3Lqod2rz62bc2zLopOb5p9YM+PwskkHKiLm+ak0gmz2VWnoyl29Yc6xQ5svH91+rSJyvrdifWvGigVdezqyV02r3dKZu6omdtHMpu0TKzb2FK7dOP94hCHIR9DQDtJsaU5bPr9jV2XUggD1phCdVn+1pkDNZm/FekhYBmm1+Ks1+qs2xln0ZLlPhQQBAzzofJUbfJUb/FQbYSHcFqLbGqrXBolFiEioHig6AzSaIWoQmsP02sL02gjHMyTadFA1k5HCAJkBCdEyzGe5AAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/115d19869f86cbf709822218d61740bb/95559/gatsby.png","srcSet":"/static/115d19869f86cbf709822218d61740bb/179d9/gatsby.png 76w,\n/static/115d19869f86cbf709822218d61740bb/837ea/gatsby.png 153w,\n/static/115d19869f86cbf709822218d61740bb/95559/gatsby.png 305w","sizes":"(min-width: 305px) 305px, 100vw"},"sources":[{"srcSet":"/static/115d19869f86cbf709822218d61740bb/c2b50/gatsby.webp 76w,\n/static/115d19869f86cbf709822218d61740bb/76f6c/gatsby.webp 153w,\n/static/115d19869f86cbf709822218d61740bb/ffe60/gatsby.webp 305w","type":"image/webp","sizes":"(min-width: 305px) 305px, 100vw"}]},"width":305,"height":165}},"publicURL":"/static/115d19869f86cbf709822218d61740bb/gatsby.png"}}}}]}},"pageContext":{"slug":"/2021-12-27-gatsby-window-is-not-available-fix/"}},
    "staticQueryHashes": []}